@using System.Text.Json

@{
    Layout = "_LayoutAdmin";
    ViewBag.Title = "Dashboard";

    @* var user = ViewData["User"] as User;  *@
    
    var Statistic = ViewData["Statistic"] as DashboardViewModel;

    @* var newCustomerOfDay =   JsonSerializer.Serialize(Statistic.StatisticOfDay.newCustomerOfDay);
    var newOrderOfDay =   JsonSerializer.Serialize(Statistic.StatisticOfDay.newOrderOfDay);
    var newContactOfDay =   JsonSerializer.Serialize(Statistic.StatisticOfDay.newContactOfDay);
    var orderDespose =   JsonSerializer.Serialize(Statistic.StatisticOfDay.orderDespose); *@
    
    var  StatisticOfDay =   JsonSerializer.Serialize(Statistic.StatisticOfDay);
    
}

                <main>
              
                    <div class="container-fluid">
                        <h1 class="mt-4">Dashboard</h1>
                        <ol class="breadcrumb mb-4">
                            <li class="breadcrumb-item active">Dashboard</li>
                        </ol>
                        <div class="row">
                            <div class="col-xl-3 col-md-6">
                                <div class="card bg-primary text-white mb-4">
                                    <div class="card-body">Khách hàng mới</div>
                                    <div class="card-footer d-flex align-items-center justify-content-between">
                                        <a class="small text-white stretched-link" href="#">@(Statistic.NewCustomer)</a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-md-6">
                                <div class="card bg-warning text-white mb-4">
                                    <div class="card-body">Thắc mắc khiếu nại</div>
                                    <div class="card-footer d-flex align-items-center justify-content-between">
                                        <a class="small text-white stretched-link" href="#">@(Statistic.Contact)</a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-md-6">
                                <div class="card bg-success text-white mb-4">
                                    <div class="card-body">Đơn hàng mới</div>
                                    <div class="card-footer d-flex align-items-center justify-content-between">
                                        <a class="small text-white stretched-link" href="#">@(Statistic.NewOrder)</a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-md-6">
                                <div class="card bg-danger text-white mb-4">
                                    <div class="card-body">Đơn hàng hủy bỏ</div>
                                    <div class="card-footer d-flex align-items-center justify-content-between">
                                        <a class="small text-white stretched-link" href="#">@(Statistic.OrderDispose)</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <figure class="highcharts-figure">
                            <div id="container"></div>
                            <p class="highcharts-description">
                                Basic line chart showing trends in a dataset. This chart includes the
                                <code>series-label</code> module, which adds a label to each line for
                                enhanced readability.
                            </p>
                            </figure>
                        </div>
                        <div class="card mb-4">
                            <div class="card-header">
                                <i class="fas fa-table mr-1"></i>
                                DataTable Example
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Position</th>
                                                <th>Office</th>
                                                <th>Age</th>
                                                <th>Start date</th>
                                                <th>Salary</th>
                                            </tr>
                                        </thead>
                                        <tfoot>
                                            <tr>
                                                <th>Name</th>
                                                <th>Position</th>
                                                <th>Office</th>
                                                <th>Age</th>
                                                <th>Start date</th>
                                                <th>Salary</th>
                                            </tr>
                                        </tfoot>
                                        <tbody>
                                            <tr>
                                                <td>Tiger Nixon</td>
                                                <td>System Architect</td>
                                                <td>Edinburgh</td>
                                                <td>61</td>
                                                <td>2011/04/25</td>
                                                <td>$320,800</td>
                                            </tr>
                                            <tr>
                                                <td>Garrett Winters</td>
                                                <td>Accountant</td>
                                                <td>Tokyo</td>
                                                <td>63</td>
                                                <td>2011/07/25</td>
                                                <td>$170,750</td>
                                            </tr>
                                            <tr>
                                                <td>Ashton Cox</td>
                                                <td>Junior Technical Author</td>
                                                <td>San Francisco</td>
                                                <td>66</td>
                                                <td>2009/01/12</td>
                                                <td>$86,000</td>
                                            </tr>
                                            <tr>
                                                <td>Cedric Kelly</td>
                                                <td>Senior Javascript Developer</td>
                                                <td>Edinburgh</td>
                                                <td>22</td>
                                                <td>2012/03/29</td>
                                                <td>$433,060</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
@StatisticOfDay

@section Css {
    <style>
        .highcharts-figure, .highcharts-data-table table {
            margin: 1em auto;
            }

            .highcharts-data-table table {
                font-family: Verdana, sans-serif;
                border-collapse: collapse;
                border: 1px solid #EBEBEB;
                margin: 10px auto;
                text-align: center;
                width: 100%;
                max-width: 500px;
            }
            .highcharts-data-table caption {
            padding: 1em 0;
            font-size: 1.2em;
            color: #555;
            }
            .highcharts-data-table th {
            font-weight: 600;
            padding: 0.5em;
            }
            .highcharts-data-table td, .highcharts-data-table th, .highcharts-data-table caption {
            padding: 0.5em;
            }
            .highcharts-data-table thead tr, .highcharts-data-table tr:nth-child(even) {
            background: #f8f8f8;
            }
            .highcharts-data-table tr:hover {
            background: #f1f7ff;
            }
    </style>
}

@section Script {
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/series-label.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <script>
        function rhtmlspecialchars(str) {

            if (typeof(str) == "string") {
                str = str.replace(/&gt;/ig, ">");
                str = str.replace(/&lt;/ig, "<");
                str = str.replace(/&#039;/g, "'");
                str = str.replace(/&quot;/ig, '"');
                str = str.replace(/&amp;/ig, '&'); /* must do &amp; last */
            }
            return str;

        }

        let timeNow = new Date();
        let data = rhtmlspecialchars('@StatisticOfDay');
        let StatisticOfDay = JSON.parse(data);

        let minDay = 1;
        let maxDay = timeNow.getDay() + 5;
        console.log(maxDay);
        let dayHasData = 0;

        @* for (const property in StatisticOfDay) {
            if( StatisticOfDay[property].length > 0) {
                StatisticOfDay[property].Data = [];
                let previousDay = minDay;
                StatisticOfDay[property].forEach(item => {

                    if(item.Day - previousDay > 1){
                        StatisticOfDay[property].Data = StatisticOfDay[property].Data.concat(new Array(item.Day - previousDay - 1).fill(0));
                    }   
                    else{
                         StatisticOfDay[property].push(item.Count);
                    }
                });
            }

            else{
              
                    StatisticOfDay[property].Data = new Array(maxDay).fill(0);
            }
               
        } *@
        console.log(StatisticOfDay);


        Highcharts.chart('container', {

            title: {
                text: `Biểu đồ lượng tương tác tổng quan tháng ${timeNow.getMonth() + 1} - ${timeNow.getFullYear()}`
            },

            subtitle: {
                text: 'Source: thesolarfoundation.com'
            },

            yAxis: {
                title: {
                text: 'Number of Employees'
                }
            },

            xAxis: {
                accessibility: {
                rangeDescription: `Range: 1 to ${timeNow.getDay()}`
                }
            },

            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'middle'
            },

            plotOptions: {
                series: {
                label: {
                    connectorAllowed: false
                },
                pointStart: 1
                }
            },

            series: [{
                name: 'Installation',
                data: [43934, 52503, 57177, 69658, 97031, 119931, 137133, 154175,10,200]
            }, {
                name: 'Manufacturing',
                data: [24916, 24064, 29742, 29851, 32490, 30282, 38121, 40434,10,200]
            }, {
                name: 'Sales & Distribution',
                data: [11744, 17722, 16005, 19771, 20185, 24377, 32147, 39387,10,200]
            }, {
                name: 'Project Development',
                data: [null, null, 7988, 12169, 15112, 22452, 34400, 34227]
            }, {
                name: 'Other',
                data: [12908, 5948, 8105, 11248, 8989, 11816, 18274, 18111]
            }],

            responsive: {
                rules: [{
                condition: {
                    maxWidth: 500
                },
                chartOptions: {
                    legend: {
                    layout: 'horizontal',
                    align: 'center',
                    verticalAlign: 'bottom'
                    }
                }
                }]
            }

            });
    </script>
}